<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:body>
	<ui:composition template="/layouts/basic-10.xhtml">
		<ui:define name="title">Sharepoint Demo Overview</ui:define>
		<ui:define name="content">
			<h:form id="form" enctype="multipart/form-data">
				<p:growl id="messages" />
				<div class="formgrid grid">

					<!-- search site section -->
					<div class="ui-fluid field col-12 md:col-4">
						<p:outputLabel value="Search Site" for="@next" />
						<p:autoComplete id="site" dropdown="true"
							value="#{overviewBean.selectedSite}" 
							completeMethod="#{overviewBean.completeSearchSite}"
							var="site" itemLabel="#{site.displayName}" itemValue="#{site}"
							converter="pojoConverter"
							scrollHeight="250" >
							<p:ajax event="itemSelect" listener="#{overviewBean.onSiteChange}" update="@form" />	 
						</p:autoComplete>
					</div>
					
					<!-- site summary section -->
					<p:fieldset legend="Site Summary" toggleable="true"
						toggleSpeed="500" rendered="#{overviewBean.showSummarySection}"
						styleClass="p-mt-4">
						<div class="ui-fluid">
						<div class="p-field">
							<p:outputLabel value="webUrl" for="@next" />
							<p:inputText id="web-url"
								value="#{overviewBean.selectedSite.webUrl}" readonly="true"/>
						</div>
						<div class="p-field">
							<p:outputLabel value="displayName" for="@next" />
							<p:inputText id="display-name"
								value="#{overviewBean.selectedSite.displayName}" readonly="true"/>
						</div>
						</div>
					</p:fieldset>

					<!-- list all field belong site -->
					<p:fieldset legend="Files on Site" toggleable="true"
						toggleSpeed="500"
						styleClass="p-mt-4">
						  <p:toolbar>
				            <p:toolbarGroup>
				                <p:commandButton id="new-folder" type="button" value="New Folder" onclick="PF('newFolderDialog').show()"
				                	icon="pi pi-folder" styleClass="ui-button-secondary" style="margin-right: .5rem">
				                </p:commandButton>
				               
				               <p:fileUpload id="fileUpload" listener="#{overviewBean.onFileUploadHandler}" mode="simple" skinSimple="true" auto="true" style="display: none"/>
				               <p:splitButton id="upload" value="Upload" action="#{overviewBean.upload}" update="messages" 
				               		icon="pi pi-upload" styleClass="ui-button-secondary">
						            <p:menuitem value="Upload File" update="messages" icon="pi pi-file" onclick="triggerFileUpload()"></p:menuitem>
						            <p:menuitem value="Upload Folder" action="#{overviewBean.uploadFolder}" icon="pi pi-folder"/>
						        </p:splitButton>
						  	    <p:commandButton id="download" type="button" value="Download" actionListener="#{overviewBean.download}" 
						  	    	icon="pi pi-download" styleClass="ui-button-secondary" style="margin-left: .5rem">
				                </p:commandButton>
				                <p:commandButton id="delete" type="button" value="Delete" actionListener="#{overviewBean.delete}" 
						  	    	icon="pi pi-trash" styleClass="ui-button-secondary" style="margin-left: .5rem">
				                </p:commandButton>
				            </p:toolbarGroup>
				        </p:toolbar>
				        <p:dataTable id="drive-items-table" var="item" value="#{overviewBean.driveItems}"
							selection="#{overviewBean.selectedDriveItem}" rowKey="#{item.id}" selectionMode="single">
							<f:facet name="header">
				              	<p:breadCrumb>
						            <p:menuitem value="Electronics" />
						            <p:menuitem value="Home" actionListener="#{overviewBean.goToRoot}" process="@this" update="@form:drive-items-table"/>
					        	</p:breadCrumb>
				            </f:facet>
							<p:ajax event="rowDblselect" 
						        listener="#{overviewBean.onRowDoubleClick}" 
						        update="@form" 
						        global="false" />
				            <p:column headerText="Name">
				             	<i class="#{item.folder != null ? 'pi pi-folder' : (fn:contains(item.file.mimeType, 'image') ? 'pi pi-images' : 'pi pi-file')}" style="margin-right: .5rem"></i>
				                <h:outputText value="#{item.name}" />
				            </p:column>
				            <p:column headerText="Modified">
				                 <h:outputText value="#{item.lastModifiedDateTime}" />
				            </p:column> 
				            <p:column headerText="Modified By">
				                <h:outputText value="#{item.lastModifiedBy.user.displayName}" />
				            </p:column>
				            <p:column exportable="false" ariaHeaderText="Actions">
				                <p:commandButton styleClass="rounded-button ui-button-success" icon="pi pi-pencil" style="margin-right: .5rem"
				                	update=""
				                    oncomplete=""
				                    process="@this">
				                </p:commandButton>
				                <p:commandButton action="#{overviewBean.deleteDriveItem(item.id)}" process="@this" update="@form" 
				                	styleClass="rounded-button ui-button-warning" icon="pi pi-times" style="margin-right: .5rem">
						            <p:confirm header="Confirmation" message="Do you want to delete this record?" icon="pi pi-info-circle"/>
						        </p:commandButton>
						        <p:commandButton
						        	styleClass="ui-button-secondary rounded-button" icon="pi pi-download" 
						        	process="@this"
				                    >
				                    <p:fileDownload value="#{overviewBean.fileDownload}"/>
				                </p:commandButton>
				            </p:column>
				        </p:dataTable>
					</p:fieldset>

					<p:dialog header="Create a folder" id="new-folder-dialog" widgetVar="newFolderDialog" minHeight="40" width="350" showEffect="fade" focus="btn-create" closeOnEscape="false">
						<div class="ui-fluid">
							<p:outputLabel value="Folder name" for="@next" />
						    <p:inputText id="folder-name" value="#{overviewBean.newFolderName}" required="true" requiredMessage="Folder name is required" />
						    <f:facet name="footer">
						    	<p:commandButton id="btn-cancel" type="button" value="Cancel" styleClass="ui-button-flat mr-2"
						        	onclick="PF('newFolderDialog').hide()" process="@this" >
						        	<p:ajax update="new-folder-dialog" resetValues="true"/>
						        </p:commandButton>
						        <p:commandButton id="btn-create" value="Create"
						        	 action="#{overviewBean.addNewFolderHandler}"
						        	 oncomplete="if (!args.validationFailed) PF('newFolderDialog').hide();" update="@form:drive-items-table @form:messages @form:folder-name">
						        </p:commandButton>
						    </f:facet>
					    </div>
					</p:dialog>
					
					<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
			            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
			            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes"/>
			        </p:confirmDialog>
			        
			        <p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false"
				              resizable="false">
				              <i class="pi pi-spinner pi-spin" style="font-size:3rem"></i>
				    </p:dialog>

				</div>

			</h:form>
			
			<script>
			    //<![CDATA[
			    function start() {
			        PF('statusDialog').show();
			    }
			
			    function stop() {
			        PF('statusDialog').hide();
			    }
			    
			    function triggerFileUpload() {
			        document.getElementById('form:fileUpload_input').click();
			    }
			    //]]>
			</script>

		</ui:define>
	</ui:composition>
</h:body>

</html>